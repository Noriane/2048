!function(t){t.fn.load_2048=function(){var e=this;this.load("2048.php",function(){function n(){return Math.random()>.2?value=2:value=4,value}function i(t){w=t;var n=e.find(".background"),i=e.find("section.active_items");n.children("div").remove(),n.css({width:110*w+"px",height:110*w+"px"}),e.find("header").css({width:"440px"}),i.find("div").remove(),n.attr("nbcol",w);for(var o=1;o<=w;o++){for(var a=1;a<=w;a++)n.append("<div></div>"),i.append("<div posx="+a+" posy="+o+"></div>");a=1}r()}function r(){var n=e.find(".active_items >div");n.filter(":not([value])"),n.filter("[value]");j=0,n.each(function(){t(this).attr("value")&&(t(this).removeAttr("value"),t(this).html(" "))}),e.find(".results >div").removeAttr("win"),document.cookie&&s("id")?a():(o("score","0",1),start_score=s("score"),datas_cookie={score:start_score},t.post("server.php",datas_cookie,function(t){a()}))}function o(t,e,n){var i=new Date;i.setTime(i.getTime()+24*n*60*60*1e3);var r="expires="+i.toUTCString();document.cookie=t+"="+e+";"+r+";path=/"}function a(){y().done(function(){return u(),f(),f(),!0})}function s(t){var e=("; "+document.cookie).split("; "+t+"=");if(2==e.length)return e.pop().split(";").shift()}function f(){var i=e.find(".active_items >div"),r=i.filter(":not([value])"),o=(i.filter("[value]"),n());i.attr("join",0);var a=t(r[Math.floor(Math.random()*r.length)]);a.attr("value",o).attr("join",0).html("<div>"+o+"</div>"),setTimeout(function(){a.addClass("grow")},20),0==(r=i.filter(":not([value])")).length&&l(i)&&c()}function u(n){var i=e.find(".score"),r=e.find(".score_max");a=parseInt(r.attr("score_max"),10);var o=e.find(".current_win");if(i.html(j),0==I)i.html("0");else{if(j>a){data={score_max:j};var a="";t.post("server.php",data,function(t){alert(t)}),e.find(".score_max").html(j)}setTimeout(function(){o.html("").removeAttr("value").fadeOut(200)},800)}n&&o.html("+"+n).attr("value",n).fadeIn(500)}function c(){return e.find(".results .loose").attr("win",0),e.find(".results").fadeIn(300),I=0,e.find(".start_again").on("click",function(){e.find(".win").removeAttr("win")}),!0}function v(){e.find(".results .win").attr("win",1),e.find(".results").fadeIn(300),e.find(".free_play").on("click",function(){e.find(".win").removeAttr("win")})}function l(t){for(var e,n,i,r=!0,o=0;o<t.length;o++){if(e=t.eq(o),n=parseInt(e.attr("posx"),10),i=parseInt(e.attr("posy"),10),e.siblings("[posx='"+(n+1)+"'][posy='"+i+"']").attr("value")==e.attr("value"))return r=!1;if(e.siblings("[posx='"+n+"'][posy='"+(i+1)+"']").attr("value")==e.attr("value"))return r=!1}return r}function d(n){if("left"==n)for(i=1;i<=w;i++)(r=e.find('.active_items >div[value][posx="'+i+'"]')).each(function(){g(t(this),n)&&(C=!0)});else if("right"==n)for(var i=w;i>=1;i--){var r=e.find('.active_items >div[value][posx="'+i+'"]');r.each(function(){g(t(this),n)&&(C=!0)})}++A<w?setTimeout(function(){d(n)},k):(C?setTimeout(function(){f(),b=!0},2*k):b=!0,A=0,C=!1)}function p(n){if("up"==n)for(i=1;i<=w;i++)(r=e.find('.active_items >div[value][posy="'+i+'"]')).each(function(){_(t(this),n)&&(C=!0)});else if("down"==n)for(var i=w;i>=1;i--){var r=e.find('.active_items >div[value][posy="'+i+'"]');r.each(function(){_(t(this),n)&&(C=!0)})}++A<w?setTimeout(function(){p(n)},k):(C?setTimeout(function(){f(),b=!0},2*k):b=!0,A=0,C=!1)}function m(t,e,n){var i=t.siblings("[posx='"+e+"'][posy='"+n+"']");i.attr("posx",t.attr("posx")),i.attr("posy",t.attr("posy")),i.removeAttr("value").removeAttr("join"),i.removeClass("grow"),i.find("div").remove(),t.attr("posx",e),t.attr("posy",n)}function h(t,e){return"left"==e&&t>1?t-1:"right"==e&&t<w?t+1:void 0}function x(t,e){return"up"==e&&t>1?t-1:"down"==e&&t<w?t+1:void 0}function g(t,e){var n=t,i=parseInt(n.attr("posy"),10),r=parseInt(n.attr("posx"),10),o=parseInt(n.attr("value"),10),a=parseInt(n.attr("join"),10);if("left"==e)s=n.siblings("[posx='"+(r-1)+"'][posy='"+i+"']");else if("right"==e)var s=n.siblings("[posx='"+(r+1)+"'][posy='"+i+"']");var f=parseInt(s.attr("value"),10),c=parseInt(s.attr("posx"),10),l=parseInt(s.attr("posy"),10);if(!s.length)return!1;if(f)for(;i==l;)if("left"==e&&r>1||"right"==e&&r<w)return o==f&&0==a&&(f=2*o,j+=f,f>999&&n.attr("smaller_font",1),u(f),f==T&&v(),n.attr("value",f),n.html("<div>"+f+"</div>"),m(n,c,l),n.attr("join",1),!0);return m(n,h(r,e),i),!0}function _(t,e){var n=t,i=parseInt(n.attr("posy"),10),r=parseInt(n.attr("posx"),10),o=parseInt(n.attr("value"),10),a=parseInt(n.attr("join"),10);if("up"==e)s=n.siblings("[posy='"+(i-1)+"'][posx='"+r+"']");else if("down"==e)var s=n.siblings("[posy='"+(i+1)+"'][posx='"+r+"']");var f=parseInt(s.attr("value"),10),c=parseInt(s.attr("posx"),10),l=parseInt(s.attr("posy"),10);if(!s.length)return!1;if(f)for(;r==c;)if("up"==e&&i>1||"down"==e&&i<w)return o==f&&0==a&&(f=2*o,j+=f,f>999&&n.attr("smaller_font",1),u(f),f==T&&v(),n.attr("value",f),n.html("<div>"+f+"</div>"),m(n,c,l),n.attr("join",1),!0);return m(n,r,x(i,e)),!0}function y(){return t.get("server.php",{option:"score"},function(t){e.find(".score_max").text(t.score_max).attr("score_max",t.score_max)}).fail(function(){alert("error")})}var w,I,k=50,b=!0,C=!1,T=2048,j=0,A=0;i(4),t(document).keydown(function(t){return!!b&&(b=!1,37==t.keyCode?(d("left"),!1):38==t.keyCode?(p("up"),!1):39==t.keyCode?(d("right"),!1):40==t.keyCode?(p("down"),!1):void 0)}),e.find("button.start").click(r),e.find("button.start_again").click(r),e.find("button[nbcol]").click(function(){i(w=t(this).attr("nbcol"))}),e.find(".maps button").on("click",function(){t(".maps button").removeClass("active"),t(this).addClass("active")})})}}(jQuery);